# 歸零起始金額 & 交易編輯功能指南

## 🎯 新功能概述

### 1️⃣ **歸零起始金額**
歸零不再只是從0開始，可以設定實際持有的起始金額。

### 2️⃣ **交易記錄編輯/刪除**
可以直接在獎金存摺頁面編輯或刪除任何記錄。

---

## 1️⃣ 歸零起始金額功能

### 📋 功能說明

#### **使用場景**

| 場景 | 起始金額 | 說明 |
|------|----------|------|
| **完全歸零** | `$0` | 實際獎金也是0，重新開始 |
| **校準金額** | `$50` | 實際還有50元獎金，系統歸零後從50開始計算 |
| **新學期繼承** | `$100` | 上學期結餘100元，新學期從100開始 |

---

### 🚀 使用方法

#### **Step 1: 新增歸零記錄**

1. 進入學生頁面 → 獎金存摺 → 新增記錄
2. 選擇「🔄 歸零」類型

```
┌──────────┬──────────┬──────────┐
│   💰     │   🛍️    │   🔄     │
│  收入    │  支出    │  歸零    │ <- 選這個
└──────────┴──────────┴──────────┘
```

---

#### **Step 2: 填寫起始金額**

```
事件名稱 *: 新學期開始
分類標籤 *: [學期更新] <- 下拉選單
日期 *:     2025/02/01
起始金額 *: 50          <- 實際持有的獎金金額
```

**說明**：
- 實際還有 $50 → 填 `50`
- 完全從零開始 → 填 `0`

---

### 📊 計算邏輯

#### **範例：起始金額 $50**

```
歷史記錄（歸零前）:
2025/01/20  +100  ❌ 不計入
2025/01/25  -30   ❌ 不計入

歸零記錄:
2025/02/01  🔄 起始金額 $50

新記錄（歸零後）:
2025/02/05  +100  ✅ 計入
2025/02/10  -20   ✅ 計入

當前餘額計算:
$50 (起始) + $100 (收入) - $20 (支出) = $130
```

---

### 🎨 顯示效果

#### **獎金存摺中的歸零記錄**

```
┌──────────────────────────────────────┐
│ 🔄  新學期開始  [歸零記錄]           │
│     學期更新     2025/02/01          │
│                    起始金額           │
│                      $50             │
└──────────────────────────────────────┘
```

#### **統計提示**

```
ℹ️ 統計數據從 2025/02/01 的歸零記錄開始計算，
   起始金額為 $50
```

---

## 2️⃣ 交易記錄編輯/刪除功能

### 📋 功能說明

在獎金存摺的每一筆記錄上都有「✏️ 編輯」按鈕。

---

### 🚀 使用方法

#### **Step 1: 進入編輯頁面**

```
獎金存摺頁面
  ↓
點擊任意記錄的「✏️ 編輯」按鈕
  ↓
編輯頁面
```

---

#### **Step 2: 編輯內容**

可以修改的項目：

| 項目 | 說明 |
|------|------|
| **記錄類型** | 收入 / 支出 / 歸零 |
| **事件名稱** | 具體描述 |
| **分類標籤** | 歸類用途 |
| **日期** | 發生日期 |
| **金額/起始金額** | 數值 |

---

#### **Step 3: 保存或刪除**

```
┌────────────────────────────────┐
│  💾 保存更改                   │  <- 保存修改
├────────────────────────────────┤
│  🗑️ 刪除此記錄                │  <- 刪除記錄
│  ⚠️ 刪除後無法復原，請謹慎操作 │
└────────────────────────────────┘
```

---

### ✨ 編輯功能特點

#### **1. 類型可切換**

```
原本: 💰 收入 +$100
修改: 🛍️ 支出 -$100  <- 可以改變類型
```

#### **2. 歸零記錄可編輯**

```
原本: 🔄 起始金額 $50
修改: 🔄 起始金額 $80  <- 可以調整起始金額
```

#### **3. 刪除前確認**

```
┌──────────────────────────────┐
│ 確定要刪除這筆記錄嗎？       │
│ 此操作無法復原。             │
│  [取消]  [確定刪除]          │
└──────────────────────────────┘
```

---

## 🎯 完整使用範例

### **範例 1：校準起始金額**

#### **情境**
系統記錄混亂，實際獎金是 $80，但系統顯示不對。

#### **操作步驟**
1. 新增歸零記錄
   - 事件名稱：`手動校準獎金`
   - 分類標籤：`系統校準`
   - 日期：`今天`
   - **起始金額：`80`**

2. 結果
   - 統計從今天開始重新計算
   - 當前餘額從 $80 開始

---

### **範例 2：修改錯誤記錄**

#### **情境**
不小心把 +$100 記成 -$100。

#### **操作步驟**
1. 在獎金存摺中找到錯誤記錄
2. 點擊「✏️ 編輯」
3. 切換類型：支出 → 收入
4. 確認金額：$100
5. 點擊「💾 保存更改」

---

### **範例 3：刪除重複記錄**

#### **情境**
同一筆獎金不小心記錄了兩次。

#### **操作步驟**
1. 找到重複的記錄
2. 點擊「✏️ 編輯」
3. 確認是重複記錄
4. 點擊「🗑️ 刪除此記錄」
5. 確認刪除

---

## 🔧 資料庫更新

### **Step 1: 執行 SQL 腳本**

在 Supabase SQL Editor 中依序執行：

#### **1. 添加 reset 類型**
```sql
-- 執行這個檔案
add-reset-transaction-type.sql
```

#### **2. 更新視圖**
```sql
-- 執行這個檔案
update-student-summary-with-reset.sql
```

---

### **Step 2: 驗證功能**

1. **測試歸零記錄**
   - 創建起始金額為 $50 的歸零記錄
   - 檢查統計是否正確

2. **測試編輯功能**
   - 編輯一筆記錄
   - 檢查是否保存成功

3. **測試刪除功能**
   - 刪除一筆測試記錄
   - 檢查是否從列表消失

---

## ⚠️ 注意事項

### **歸零記錄**

| ⚠️ 注意 | 說明 |
|---------|------|
| **起始金額不能為負** | 最小值為 0 |
| **影響所有統計** | 歸零後統計從新起點計算 |
| **可多次歸零** | 系統自動使用最近的一次 |

### **編輯/刪除**

| ⚠️ 注意 | 說明 |
|---------|------|
| **刪除無法復原** | 刪除前請再三確認 |
| **影響統計** | 修改金額會影響餘額計算 |
| **評量獎金記錄** | 由評量自動生成的記錄，建議從評量頁面修改 |

---

## 📂 相關檔案

| 檔案 | 說明 |
|------|------|
| `add-reset-transaction-type.sql` | 添加 reset 類型 |
| `update-student-summary-with-reset.sql` | 更新視圖計算邏輯 |
| `AddTransactionForm.tsx` | 起始金額輸入表單 |
| `EditTransactionForm.tsx` | 編輯交易記錄表單 |
| `TransactionRecords.tsx` | 顯示編輯按鈕 |
| `/api/transactions/update/route.ts` | 更新 API |
| `/api/transactions/delete/route.ts` | 刪除 API |

---

## ✅ 功能檢查清單

### **歸零起始金額**
- [ ] ✅ 執行 `add-reset-transaction-type.sql`
- [ ] ✅ 執行 `update-student-summary-with-reset.sql`
- [ ] ✅ 測試創建起始金額為0的歸零記錄
- [ ] ✅ 測試創建起始金額為50的歸零記錄
- [ ] ✅ 檢查統計提示是否顯示起始金額
- [ ] ✅ 驗證餘額計算是否正確

### **編輯/刪除功能**
- [ ] ✅ 測試編輯收入記錄
- [ ] ✅ 測試編輯支出記錄
- [ ] ✅ 測試編輯歸零記錄
- [ ] ✅ 測試刪除記錄
- [ ] ✅ 驗證刪除確認對話框
- [ ] ✅ 檢查編輯後統計是否更新

---

## 🎉 總結

### **歸零起始金額**
```
不再只能從0開始
↓
可以設定實際持有的獎金金額
↓
適合校準、新學期繼承等場景
```

### **編輯/刪除功能**
```
每筆記錄都有編輯按鈕
↓
可修改類型、金額、日期等
↓
可刪除錯誤或重複記錄
```

---

🎊 **兩個新功能讓獎金管理更靈活、更方便！**

